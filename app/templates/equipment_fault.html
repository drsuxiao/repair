{% extends 'base_database.html' %}
{% block title %}设备故障管理{% endblock %}
{% block function %}
    <button type="button" class="btn btn-primary btn-sm" id="database_add">新增</button>
    <button type="button" class="btn btn-primary btn-sm" id="database_edit">修改</button>
    <button type="button" class="btn btn-primary btn-sm" id="database_delete">删除</button>
{% endblock %}

{% block script %}
{{ super() }}
<script>
    initTable('/repair/api/v1.0/equipment_faults', ['设备故障编码','设备故障名称']);
</script>
<!-- 按钮事件 -->
<script type="text/javascript">
    $("#database_add").click(function(){
        action = 'add';
        $("#modal_database").modal("show");
    });
    $("#database_edit").click(function(){
        action = 'edit';
        var row = $("#table_database").bootstrapTable('getSelections');
        if (row.length == 1){
            $("#modal_database").modal("show");
        }else{ alert('请勾选一条需要处理的记录后，再进行操作！');}
    });
    $("#database_delete").click(function(){
        action = 'delete';
        var row = $("#table_database").bootstrapTable('getSelections');
        if (row.length == 1){
            $("#modal_delete").modal("show");
        }else{ alert('请勾选一条需要处理的记录后，再进行操作！');}
    });
    $("#delete_confirm").click(function(){
         if (action == 'delete'){
             url = '/repair/api/v1.0/equipment_faults/delete/' + cur_key
             ajax_post_data(url, {});
             $("#modal_delete").modal("hide");
             $("#table_database").bootstrapTable("refresh");  //刷新表格数据
         };
    });
    //新增，编辑根据post的url来区别
    $("#modal_save").click(function(e) {
        if ($("#code").val() && $("#name").val()){
            e.preventDefault();
            if (action == 'add'){
                url = '/repair/api/v1.0/equipment_faults/add';
            } else if (action == 'edit'){
                url = '/repair/api/v1.0/equipment_faults/edit/' + cur_key;
            }else{url = ''};

            ajax_post_data(url, get_json_data());

            $("#modal_database").modal("hide");     //隐藏模态框
            $("#table_database").bootstrapTable("refresh");  //刷新表格数据
            //$("#modal_database")[0].reset();  //重置表单，恢复为默认值 如何解决表单重置reset is not a function 出错 问题就在于id="reset"和name="reset"，这里的reset属性覆盖了原来的reset方法
        }
    });
</script>
<!-- 模态框相关事件 -->
<script>
    function InitModalAddForm(){
        if (action == 'add'){
            //清除文本框的值,包含隐藏input
            $("#modal_database input").val("");
        }
        else if (action == 'edit'){
            var row = $("#table_database").bootstrapTable('getSelections');
            //alert(JSON.stringify(row[0]));
            if (row.length == 1){
                var edit_date = row[0];
                $("#modal_database input").each(function(){
                    $(this).val(edit_date[$(this).attr("id")]);
                });
            };
        };
    };

    $("#modal_database").on('shown.bs.modal', function () {
        //初始化新增界面
        InitModalAddForm();
    });

</script>
{% endblock %}